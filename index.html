  </div>

    <script>
        console.log('Plugin starting...');
        console.log('Front available:', typeof Front !== 'undefined');
        console.log('Front.contextUpdates:', Front.contextUpdates);
        
        Front.contextUpdates.subscribe(context => {
            console.log('Context received:', context);

            if (context.type === 'singleConversation') {
                const conversation = context.conversation;
                console.log('Conversation:', conversation);
                console.log('Custom objects:', conversation.customObjects);
                console.log('Links:', conversation.links);

                // Find the "Get Loan Number" object
                const loanObject = conversation.customObjects?.find(obj => 
                    obj.type === 'Get Loan Number'
                // Find the "Tasks Form" link
                const tasksLink = conversation.links?.find(link => 
                    link.name === 'Tasks Form'
                );

                if (loanObject) {
                    console.log('Loan object found:', loanObject);
                if (tasksLink && tasksLink.externalUrl) {
                    console.log('Tasks Form URL found:', tasksLink.externalUrl);

                    const taskUrl = loanObject.targetUrl || loanObject.fields?.['Tasks Form'];
                    console.log('Task URL:', taskUrl);
                    
                    if (taskUrl) {
                        document.getElementById('content').innerHTML = 
                            `<iframe src="${taskUrl}"></iframe>`;
                    } else {
                        document.getElementById('content').innerHTML = 
                            `<div class="message">
                                <p>Loan found but no URL available</p>
                            </div>`;
                    }
                    // Display the form in an iframe
                    document.getElementById('content').innerHTML = 
                        `<iframe src="${tasksLink.externalUrl}"></iframe>`;
                } else {
                    document.getElementById('content').innerHTML = 
                        `<div class="message">
                            <p>No loan number detected in this conversation</p>
                            <p>No task form found for this loan</p>
                        </div>`;
                }
            } else if (context.type === 'noConversation') {
                document.getElementById('content').innerHTML = 
                    `<div class="message"><p>No conversation selected</p></div>`;
                    `<div class="message"><p>Select a conversation to view the task form</p></div>`;
            }
        });
    </script>
